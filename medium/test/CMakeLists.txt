cmake_minimum_required(VERSION 2.8)
project(test_somthing CXX)

message("To test your project, please type \"ctest\""
	 " after typing \"make\".")

# You must execture this command before using CTest. On the other
# hand, you can also simply comment-out this code to disable CTest.
enable_testing()

function(test_source source)
	add_executable(${source} err_dir/${source}.cpp)
	# The first argument denotes test name. The second argument
	# denotes the testing command. testing command can be a shell
	# command or a script of any language. In this case, testing
	# command is a executable generated by build tools. but
	# the command is not limited to executables, Shell scripts or
	# Python or Perl are accepted.

	# ${source} is a target of CMake. Just like targets of Make,
	# $<TARGET_FILE: target_name> represents the output of the
	# target_name.
	add_test(NAME ${source}_test COMMAND $<TARGET_FILE:${source}>)
endfunction(test_source)

test_source(abort)
test_source(invalid_ptr)
test_source(stderr)
test_source(assert_fail)
test_source(main_return_1)
test_source(uncatchd_exception)
